sudo: required
addons:
  apt:
    update: true
    packages:
    - docker-ce
services:
- docker
script:
- export DOCKER_CLI_EXPERIMENTAL=enabled
- source sha_function.sh
- flag=$(is_base "vmnet8/turtleblocksjs:latest" "vmnet8/nginx:latest")
- echo $flag
- echo "$DOCKERPASS" | docker login -u vmnet8 --password-stdin
- docker run --rm --privileged multiarch/qemu-user-static --reset -p yes
- "./docker-build.sh vmnet8/nginx:latest arm"
- "./docker-build.sh vmnet8/nginx:latest arm64"
- "./docker-build.sh vmnet8/nginx:latest amd64"
before_deploy:
- timetag=$(date +%Y%m%d%H%M)
- echo $timetag
- tag1="latest"
- tag2=$timetag
- echo "timetag is $tag2"
- create_manifest vmnet8/turtleblocksjs $tag1 $tag2 vmnet8/turtleblocksjs-tags:amd64
  vmnet8/turtleblocksjs-tags:arm vmnet8/turtleblocksjs-tags:arm64
- docker manifest inspect vmnet8/turtleblocksjs:$tag1
- docker manifest inspect vmnet8/turtleblocksjs:$tag2
deploy:
- provider: script
  script: docker manifest push vmnet8/turtleblocksjs:$tag1; docker manifest push vmnet8/turtleblocksjs:$tag2
  skip_cleanup: true
  on:
    all_branches: true
    condition: "$flag = true"
env:
  global:
  - secure: cFImrYDPyPl2aa1OV3td2qZTPyUxMrS9fnurW6gzcNgxpbgHBG9XK6yY7B/zJnUMjLWfFD5AEMumc7xO76gKE8vyQWGxS8+cW6Hf6XQ8cRSsz/gyYoY1WMbL4K2Y/h3tBFPGDgXdTIBznGlollRl6UaYo9wLHO93i6xE+k1YkPD40d8FsSTunc/WT+tSnIs9uMsc3yYGIVj4qivBWGYoJfzGgoRiz1tPN52NhW3GdWk0H+BsxMkYfAbBZQBaJ4myCC9BRGEynKpYVC2xo2TSGNCYU1rLCbyzRk7QMRxzVCwiwxepZZBmj9UlWr2CW+SELhXyz9Z+s1e7Odxvb8YX4a6C6tpPNVhsukFRatFbdVw+VIsPh27RqPBfBSopMwBGTzS1/JALaTJWA3fkbJ4js9Fr4nSw3QwlaHq5xoUsNojxJCS240QCnCwYxPOYxOG4UtSDl2ClUubx2s5N7axZ7ImVpH4La+Z3DRd/4toUiLC8Cpm0w5rEgdbQ0weyC499EoukhndyShwM7eVUxR4qzicDrbkx4oFPiDddBdIVnKVDQ9WZlVEsFUeLVYuSs+W1qRkX1/vV4DJ23Mnm75zOGYEjJKCdHZKbpv4TgvG+3/LfimPTu+FKRdiFdS4Z0p9Pz46Foqfnnlie05gv3A82QAPuyt4PkWCrbYJyLERWZQ0=
